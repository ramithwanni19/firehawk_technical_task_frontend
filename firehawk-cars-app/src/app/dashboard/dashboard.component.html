<div class="dashboard">
  <header>
    <div class="header-left">
      <h1>John's Car Registry 
        <span class="count-badge">{{ totalRecords }} Total Records</span>
      </h1>
    </div>
    
    <div class="header-right" style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap; justify-content: flex-end;">
      <div class="active-filters-list" style="display: flex; gap: 8px; flex-wrap: wrap;">
        <ng-container *ngFor="let filter of getActiveFilterKeys()">
          <div class="filter-chip" (click)="removeFilter(filter)"
               style="background: #dbeafe; color: #1e40af; padding: 4px 10px; border-radius: 16px; font-size: 0.75rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; border: 1px solid #bfdbfe;">
            <span>{{ formatLabel(filter) }}: {{ activeFilters[filter] }}</span>
            <span style="font-size: 14px;">√ó</span>
          </div>
        </ng-container>
      </div>

      <button class="page-btn" (click)="showFilterModal = true">
        üîç Advanced Filter
      </button>
    </div>
  </header>

  <div class="table-card">
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th (click)="setSort('make')" [class.sortable]="!isFiltering">Make</th>
            <th (click)="setSort('model')" [class.sortable]="!isFiltering">Model</th>
            <th>MPG</th>
            <th>Cyl</th>
            <th>Disp</th>
            <th>HP</th>
            <th>Weight</th>
            <th>Acc</th>
            <th>Year</th>
            <th>Origin</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let car of cars">
            <td class="primary-text">{{ car.make }}</td>
            <td class="model-text">{{ car.model }}</td>
            <td>{{ car.mpg }}</td>
            <td>{{ car.cylinders }}</td>
            <td>{{ car.displacement }}</td>
            <td>{{ car.horsepower }}</td>
            <td>{{ car.weight | number }}</td>
            <td>{{ car.acceleration }}</td>
            <td>{{ car.model_year }}</td>
            <td class="origin-text">{{ car.origin }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="showFilterModal" (click)="showFilterModal = false">
    <div class="filter-popup" (click)="$event.stopPropagation()">
      <div class="popup-header">
        <h2>Advanced Filter</h2>
        <p class="subtitle">Select one criteria to filter by</p>
        <button class="close-x" (click)="showFilterModal = false">‚úï</button>
      </div>
      
      <div class="popup-body">
        <div class="filter-grid">
          <div class="filter-input-group" [class.disabled-group]="isFieldDisabled('make')">
            <label>Make</label>
            <input type="text" [(ngModel)]="tempFilters.make" [disabled]="isFieldDisabled('make')" placeholder="e.g. Dodge">
          </div>

          <div class="filter-input-group" [class.disabled-group]="isFieldDisabled('model')">
            <label>Model</label>
            <input type="text" [(ngModel)]="tempFilters.model" [disabled]="isFieldDisabled('model')" placeholder="e.g. Magnum">
          </div>

          <div class="filter-input-group" [class.disabled-group]="isFieldDisabled('model_year')">
            <label>Year (YY)</label>
            <input type="number" [(ngModel)]="tempFilters.model_year" [disabled]="isFieldDisabled('model_year')" placeholder="78">
          </div>

          <div class="filter-input-group" [class.disabled-group]="isFieldDisabled('cylinders')">
            <label>Cylinders</label>
            <input type="number" [(ngModel)]="tempFilters.cylinders" [disabled]="isFieldDisabled('cylinders')" placeholder="8">
          </div>

          <div class="filter-input-group" [class.disabled-group]="isFieldDisabled('origin')">
            <label>Origin</label>
            <select [(ngModel)]="tempFilters.origin" [disabled]="isFieldDisabled('origin')">
              <option value="">All Regions</option>
              <option value="usa">USA</option>
              <option value="europe">Europe</option>
              <option value="japan">Japan</option>
            </select>
          </div>
        </div>
      </div>

      <div class="popup-footer">
        <button class="btn-text" (click)="clearFilters()">Reset All</button>
        <button class="page-btn" (click)="applyFilters()">Apply Filter</button>
      </div>
    </div>
  </div>
</div>