<div class="dashboard">
  <header>
    <div class="header-left">
      <h1>John's Car Registry 
        <span class="count-badge">{{ totalRecords }} Total Records</span>
      </h1>
    </div>
    
    <div class="header-right" style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap; justify-content: flex-end;">
      <div class="active-filters-list" style="display: flex; gap: 8px; flex-wrap: wrap;">
        <ng-container *ngFor="let filter of getActiveFilterKeys()">
          <div class="filter-chip" (click)="removeFilter(filter)"
               style="background: #dbeafe; color: #1e40af; padding: 4px 10px; border-radius: 16px; font-size: 0.75rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; border: 1px solid #bfdbfe;">
            <span>{{ formatLabel(filter) }}: {{ activeFilters[filter] }}</span>
            <span style="font-size: 14px;">√ó</span>
          </div>
        </ng-container>
      </div>

      <button class="page-btn" (click)="showFilterModal = true">
        üîç Advanced Filter
      </button>
    </div>
  </header>

  <div class="table-card">
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th (click)="setSort('make')" class="col-make sortable">
              <div class="th-content">
                <span>Make</span>
                <div class="sort-indicator">
                  <span class="arrow" [class.highlight]="sortColumn === 'make' && sortDirection === 'asc'">‚ñ≤</span>
                  <span class="arrow" [class.highlight]="sortColumn === 'make' && sortDirection === 'desc'">‚ñº</span>
                </div>
              </div>
            </th>
            <th (click)="setSort('model')" class="col-model sortable">
              <div class="th-content">
                <span>Model</span>
                <div class="sort-indicator">
                  <span class="arrow" [class.highlight]="sortColumn === 'model' && sortDirection === 'asc'">‚ñ≤</span>
                  <span class="arrow" [class.highlight]="sortColumn === 'model' && sortDirection === 'desc'">‚ñº</span>
                </div>
              </div>
            </th>
            <th *ngFor="let col of [{id:'mpg', n:'MPG'}, {id:'cylinders', n:'Cyl'}, {id:'displacement', n:'Disp'}, {id:'horsepower', n:'HP'}, {id:'weight', n:'Weight'}, {id:'acceleration', n:'Acc'}, {id:'model_year', n:'Year'}]" 
                (click)="setSort(col.id)" class="col-data sortable">
              <div class="th-content">
                <span>{{col.n}}</span>
                <div class="sort-indicator">
                  <span class="arrow" [class.highlight]="sortColumn === col.id && sortDirection === 'asc'">‚ñ≤</span>
                  <span class="arrow" [class.highlight]="sortColumn === col.id && sortDirection === 'desc'">‚ñº</span>
                </div>
              </div>
            </th>
            <th (click)="setSort('origin')" class="col-origin sortable">
              <div class="th-content">
                <span>Origin</span>
                <div class="sort-indicator">
                  <span class="arrow" [class.highlight]="sortColumn === 'origin' && sortDirection === 'asc'">‚ñ≤</span>
                  <span class="arrow" [class.highlight]="sortColumn === 'origin' && sortDirection === 'desc'">‚ñº</span>
                </div>
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let car of cars">
            <td class="primary-text">{{ car.make }}</td>
            <td class="model-text">{{ car.model }}</td>
            <td>{{ car.mpg }}</td>
            <td>{{ car.cylinders }}</td>
            <td>{{ car.displacement }}</td>
            <td>{{ car.horsepower }}</td>
            <td>{{ car.weight | number }}</td>
            <td>{{ car.acceleration }}</td>
            <td>{{ car.year }}</td>
            <td class="origin-text">{{ car.origin }}</td>
          </tr>
          <tr *ngIf="cars.length === 0">
            <td colspan="10" style="text-align: center; padding: 40px; color: #64748b;">
              No matching records found.
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="table-footer">
      <button class="page-btn" (click)="prevPage()" [disabled]="currentPage === 1">Previous</button>
      <div class="page-info">
        Page <strong>{{ currentPage }}</strong> of <strong>{{ totalPages }}</strong>
        <span style="margin-left: 12px; font-size: 0.8rem; opacity: 0.7;">(Showing {{ cars.length }} results)</span>
      </div>
      <button class="page-btn" (click)="nextPage()" [disabled]="!nextPageToken">Next</button>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="showFilterModal">
    <div class="filter-popup">
      <div class="popup-header">
        <h2>Advanced Filter</h2>
        <button class="close-x" (click)="showFilterModal = false">‚úï</button>
      </div>
      
      <div class="popup-body">
        <div class="filter-grid">
          <div class="filter-input-group">
            <label>Make</label>
            <input type="text" [(ngModel)]="tempFilters.make" placeholder="e.g. Dodge">
          </div>
          <div class="filter-input-group">
            <label>Model</label>
            <input type="text" [(ngModel)]="tempFilters.model" placeholder="e.g. Magnum">
          </div>
          <div class="filter-input-group">
            <label>Year (YY)</label>
            <input type="number" [(ngModel)]="tempFilters.model_year" placeholder="78">
          </div>
          <div class="filter-input-group">
            <label>Cylinders</label>
            <input type="number" [(ngModel)]="tempFilters.cylinders" placeholder="8">
          </div>
          <div class="filter-input-group">
            <label>Min MPG</label>
            <input type="number" [(ngModel)]="tempFilters.mpg" placeholder="17.5">
          </div>
          <div class="filter-input-group">
            <label>Horsepower</label>
            <input type="number" [(ngModel)]="tempFilters.horsepower" placeholder="140">
          </div>
          <div class="filter-input-group">
            <label>Origin</label>
            <select [(ngModel)]="tempFilters.origin">
              <option value="">All Regions</option>
              <option value="usa">USA</option>
              <option value="europe">Europe</option>
              <option value="japan">Japan</option>
            </select>
          </div>
        </div>
      </div>

      <div class="popup-footer">
        <button class="btn-text" (click)="clearFilters()">Reset All</button>
        <button class="page-btn" (click)="applyFilters()">Apply Filters</button>
      </div>
    </div>
  </div>
</div>